# Memento
---

__Memento__ provides a mechanism for saving snapshots of an objectâ€™s state at various points in time in order to be restored at another time it in future.

---
## Example
```Swift
// The Originator is responsible for generating snapshots of an object's state
// Each stored snapshot is referred to as a Memento
protocol Originator {
    associatedtype MementoType
    var memento : MementoType { get set }
}

// The CareTaker is responsible for saving snapshots generated by the Originator
// It holds the orignator and implements the saving & restoration of Mementos
protocol CareTaker {
    associatedtype OriginatorType : Originator
    var originator : OriginatorType { get set }
    var mementos : [OriginatorType.MementoType] { get set }
    mutating func save()
    mutating func restore()
}
extension CareTaker {
    mutating func save() {
        mementos.append(originator.memento)
    }
    mutating func restore() {
        guard let _ = mementos.last else { return }
        originator.memento = mementos.removeLast()
    }
}

// Value is the object we want to snapshot
// It implements logic for value updates, as well as snapshot generation
struct Value : Codable {
    public private(set) var lastUpdated : Date
    public private(set) var value : Int {
        didSet { lastUpdated = Date() }
    }
    public mutating func add(_ value: Int) {
        self.value += value
    }
    public mutating func subtract(_ value: Int) {
        self.value -= value
    }
}
extension Value : Originator {
    typealias MementoType = Data
    var memento : MementoType {
        get { try! JSONEncoder().encode(self) }
        set { self = try! JSONDecoder().decode(type(of: self), from: newValue) }
    }
}
extension Value : CustomStringConvertible {
    var description: String {
        "\(value) \(ISO8601DateFormatter().string(from: lastUpdated))"
    }
}

// Adder is a simple adder utility that also acts as the CareTaker
struct Adder : CareTaker {

    // CareTaker protocol conformance
    typealias OriginatorType = Value
    var originator: Value = Value(lastUpdated: Date(), value: 0)
    var mementos : [Data] = []
    
    // Adder functionality
    public var value : Value { originator }
    public mutating func add(_ value: Int) {
        originator.add(value)
    }
    public mutating func subtract(_ value: Int) {
        originator.subtract(value)
    }
}

// Use Case:
// Create an adder, perform a number of addition & subtraction
// save the state of each arithmetic operation at each stage
var adder = Adder()
adder.save()
for i in 1...5 {
    sleep(1)
    adder.add(i)
    adder.save()
    sleep(1)
    adder.subtract(i)
    adder.save()
}

// Rewind each intermediate arithmetic operation performed above
for _ in 1...10 {
    adder.restore()
    print(adder.value)
}

// Console Output:
// 0 2020-04-24T03:23:43Z
// 5 2020-04-24T03:23:42Z
// 0 2020-04-24T03:23:41Z
// 4 2020-04-24T03:23:40Z
// 0 2020-04-24T03:23:39Z
// 3 2020-04-24T03:23:38Z
// 0 2020-04-24T03:23:37Z
// 2 2020-04-24T03:23:36Z
// 0 2020-04-24T03:23:35Z
// 1 2020-04-24T03:23:34Z
```
